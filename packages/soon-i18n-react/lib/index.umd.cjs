(function(u,t){typeof exports=="object"&&typeof module<"u"?t(exports,require("react"),require("soon-i18n-common")):typeof define=="function"&&define.amd?define(["exports","react","soon-i18n-common"],t):(u=typeof globalThis<"u"?globalThis:u||self,t(u["soon-i18n-react"]={},u.react,u["soon-i18n-common"]))})(this,function(u,t,a){"use strict";const h=(E,K)=>{const b=E.fallbacks??[],O={},i={};a.loadSyncLocales(K,i);let f=E.lang??"";const o=[],g=()=>{o.forEach(c=>{c()})},j=c=>{f=c,o.forEach(e=>{e(c),e()})},T=()=>f,R=()=>{const[c,e]=t.useState(f);return t.useEffect(()=>{const l=s=>{s&&e(s)};return o.push(l),()=>{const s=o.findIndex(r=>r===l);o.splice(s,1)}},[]),[c,j]},_=()=>{const[c,e]=t.useState(1);return t.useEffect(()=>{const l=s=>{s||e(r=>r+1)};return o.push(l),()=>{const s=o.findIndex(r=>r===l);o.splice(s,1)}},[]),[c,e]};return{useLocales:c=>{const e=t.useRef(a.loadSyncLocales(c)),l=t.useRef({}),[s,r]=_(),[y,G]=t.useState(0),L=t.useRef({updateGlobal:!1,updateLocal:!1}),d=t.useRef(!1);return t.useEffect(()=>(d.current=!0,L.current.updateGlobal?g():r(p=>p+1),()=>{d.current=!1}),[]),t.useEffect(()=>{d.current&&G(s)},[s]),t.useCallback((p,...q)=>{const k={};return[f,...b].reverse().forEach(n=>{Object.assign(k,i[n],e.current[n])}),(!e.current[f]||!(p in k))&&[f,...b].some(n=>{if(!e.current[n])return a.loadLocale(S=>{e.current[n]||(e.current={...e.current,[n]:a.flatTreeKey(S)},d.current?r(v=>v+1):L.current.updateLocal=!0)},l.current,n,c),!0;if(!i[n])return a.loadLocale(S=>{i[n]=a.flatTreeKey(S),d.current?g():L.current.updateGlobal=!0},O,n,K),!0}),a.formatObjKey(k,p,...q)},[y])},useLang:R,tLocales:c=>{const e={};return a.loadSyncLocales(c,e),(l,...s)=>{const r={};return[f,...b].reverse().forEach(y=>{Object.assign(r,i[y],e[y])}),a.formatObjKey(r,l,...s)}},getLang:T,setLang:j}},x=h;u.createI18n=h,u.createI18nSafe=x,Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});
